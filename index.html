<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Dakika Görüntüleyici</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Player'ın aspect ratio'sunu korumak için */
        .aspect-video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
        }
        .aspect-video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 md:p-8 space-y-6">
        <header>
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-900">YouTube Video Dakika Görüntüleyici</h1>
            <p class="text-center text-gray-500 mt-2">Bir YouTube video linki yapıştırın ve videoyu birer dakikalık bölümler halinde izleyin.</p>
        </header>

        <!-- URL Giriş Alanı -->
        <div class="flex flex-col sm:flex-row gap-3">
            <input type="text" id="youtube-url" placeholder="YouTube video linkini buraya yapıştırın..." class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
            <button id="load-video-btn" class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Videoyu Yükle
            </button>
        </div>

        <!-- Video ve Metin Alanı -->
        <div id="player-container" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- YouTube Player -->
            <div class="aspect-video-container bg-gray-200 rounded-lg overflow-hidden">
                <div id="player"></div>
            </div>

            <!-- Transcript ve Kontroller -->
            <div class="flex flex-col">
                <div id="transcript-container" class="flex-grow bg-gray-50 p-4 border rounded-lg h-64 lg:h-auto overflow-y-auto">
                    <p class="text-gray-500">Metin (transcript) burada görünecek. Lütfen önce bir video yükleyin.</p>
                </div>
                <div class="mt-4 p-4 bg-gray-100 rounded-lg">
                    <div id="time-info" class="text-center font-mono text-lg mb-3">
                        Bölüm: <span id="current-segment">--:--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <button id="prev-minute-btn" disabled class="px-5 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition">
                            &larr; Önceki
                        </button>
                        <button id="next-minute-btn" disabled class="px-5 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition">
                            Sonraki &rarr;
                        </button>
                    </div>
                </div>
            </div>
        </div>
         <!-- Hata Mesajı -->
        <div id="error-message" class="hidden text-center text-red-600 bg-red-100 p-3 rounded-lg"></div>
    </div>

    <script>
        // YouTube IFrame Player API'sini asenkron olarak yükle
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        let player;
        let timeChecker; // setInterval'ı tutmak için değişken
        let currentSegment = 0; // Mevcut 1 dakikalık bölüm (0'dan başlar)
        let totalSegments = 0;

        const urlInput = document.getElementById('youtube-url');
        const loadBtn = document.getElementById('load-video-btn');
        const playerContainer = document.getElementById('player-container');
        const prevBtn = document.getElementById('prev-minute-btn');
        const nextBtn = document.getElementById('next-minute-btn');
        const transcriptDiv = document.getElementById('transcript-container');
        const currentSegmentSpan = document.getElementById('current-segment');
        const errorMessageDiv = document.getElementById('error-message');

        // API hazır olduğunda bu fonksiyon çağrılır
        function onYouTubeIframeAPIReady() {
            // Player'ı başlangıçta oluşturmuyoruz, kullanıcı link girince oluşturacağız.
        }

        // YouTube video ID'sini çeşitli URL formatlarından ayıklayan fonksiyon
        function getVideoId(url) {
            let videoId = '';
            const youtubeRegex = /^(?:https-?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|v\/|)([\w-]{11})(?:\S+)?$/;
            const match = url.match(youtubeRegex);
            if (match && match[1]) {
                videoId = match[1];
            }
            return videoId;
        }

        function displayError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
        }

        function clearError() {
            errorMessageDiv.classList.add('hidden');
        }

        // Videoyu yükle butonuna tıklandığında
        loadBtn.addEventListener('click', () => {
            const videoUrl = urlInput.value.trim();
            if (!videoUrl) {
                displayError("Lütfen geçerli bir YouTube video linki girin.");
                return;
            }
            
            const videoId = getVideoId(videoUrl);
            
            if (!videoId) {
                displayError("Geçersiz YouTube URL'si. Lütfen linki kontrol edin.");
                return;
            }

            clearError();
            playerContainer.classList.remove('hidden');
            currentSegment = 0; // Yeni video için segmenti sıfırla

            // Eğer daha önce bir player oluşturulduysa, sadece yeni videoyu yükle
            if (player) {
                player.loadVideoById(videoId);
            } else {
                // Yoksa yeni bir player oluştur
                player = new YT.Player('player', {
                    height: '360',
                    width: '640',
                    videoId: videoId,
                    playerVars: {
                        'playsinline': 1,
                        'rel': 0 // İlgili videoları gösterme
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
        });

        // Player hazır olduğunda
        function onPlayerReady(event) {
            const duration = player.getDuration();
            totalSegments = Math.ceil(duration / 60);
            updateControls();
            updateTranscript();
        }

        // Player durumu değiştiğinde (oynatılıyor, durdu vs.)
        function onPlayerStateChange(event) {
            // Video oynatılmaya başlandığında
            if (event.data == YT.PlayerState.PLAYING) {
                const segmentEndTime = (currentSegment + 1) * 60;
                
                // Önceki zamanlayıcıyı temizle
                if (timeChecker) {
                    clearInterval(timeChecker);
                }

                // Her 250ms'de bir videonun mevcut zamanını kontrol et
                timeChecker = setInterval(() => {
                    const currentTime = player.getCurrentTime();
                    // Eğer mevcut zaman, bölümün bitiş zamanını geçtiyse videoyu durdur
                    if (currentTime >= segmentEndTime) {
                        player.pauseVideo();
                        // Zamanlayıcıyı temizle, çünkü video durdu
                        clearInterval(timeChecker);
                    }
                }, 250);
            } else {
                // Video oynamıyorsa (duraklatıldı, bitti vs.) zamanlayıcıyı temizle
                if (timeChecker) {
                    clearInterval(timeChecker);
                }
            }
        }

        // Kontrol butonlarının durumunu güncelle
        function updateControls() {
            // Önceki butonu: İlk segmentte değilsek aktif
            prevBtn.disabled = currentSegment === 0;
            // Sonraki butonu: Son segmentte değilsek aktif
            nextBtn.disabled = currentSegment >= totalSegments - 1;

            const start = currentSegment * 60;
            const end = (currentSegment + 1) * 60;
            currentSegmentSpan.textContent = `${formatTime(start)} - ${formatTime(end)}`;
        }

        // Metin alanını güncelle
        function updateTranscript() {
            // ÖNEMLİ NOT: YouTube API'si doğrudan metin (transcript/altyazı) verisi sağlamaz.
            // Bu özelliği çalışır hale getirmek için sunucu taraflı (backend) bir kod yazmak
            // ve youtube-transcript-api gibi bir kütüphane kullanmak gerekir.
            // Bu örnekte, bu işlevsellik sembolik olarak gösterilmiştir.
            const startTime = currentSegment * 60;
            const endTime = (currentSegment + 1) * 60;
            transcriptDiv.innerHTML = `
                <h3 class="font-bold text-lg mb-2">Bölüm Metni (${formatTime(startTime)} - ${formatTime(endTime)})</h3>
                <p class="text-gray-600 italic">
                    Bu videonun bu bölümü için metin (transcript) verisi şu anda gösterilemiyor. 
                    Bu özelliğin çalışması için sunucu taraflı bir entegrasyon gereklidir.
                </p>
            `;
        }
        
        // Zamanı MM:SS formatına çevirir
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }

        // Önceki dakika butonuna tıklama olayı
        prevBtn.addEventListener('click', () => {
            if (currentSegment > 0) {
                currentSegment--;
                player.seekTo(currentSegment * 60);
                player.playVideo(); // Yeni segmente gidince otomatik oynat
                updateControls();
                updateTranscript();
            }
        });

        // Sonraki dakika butonuna tıklama olayı
        nextBtn.addEventListener('click', () => {
            if (currentSegment < totalSegments - 1) {
                currentSegment++;
                player.seekTo(currentSegment * 60);
                player.playVideo(); // Yeni segmente gidince otomatik oynat
                updateControls();
                updateTranscript();
            }
        });

    </script>
</body>
</html>
