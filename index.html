<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEng</title>
    <style>
        /* General Body Styles */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #2c3e50; 
            color: #ecf0f1; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px; 
            box-sizing: border-box; 
        }

        /* Main container for the quiz */
        .quiz-container { 
            background-color: #34495e; 
            border-radius: 15px; 
            padding: 70px 30px 30px 30px; 
            width: 100%; 
            max-width: 800px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            position: relative; 
            border: 1px solid #4a6572;
        }

        /* Header for the question section */
        .question-header { 
            border-bottom: 2px solid #7f8c8d; 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }

        .sentence { font-size: 1.4em; font-style: italic; margin-bottom: 0; flex-grow: 1; }
        .prompt { font-size: 1.2em; font-weight: 500; margin-bottom: 20px; color: #bdc3c7; }
        
        /* Options grid */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        /* Individual option button */
        .option-btn {
            background-color: #4a6572;
            color: #ecf0f1;
            border: none;
            padding: 15px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: left;
        }
        .option-btn:hover { background-color: #5b7c8c; transform: translateY(-2px); }
        .option-btn:disabled { background-color: #3e5260; color: #7f8c8d; cursor: not-allowed; transform: none; }

        /* SRS action buttons container */
        .srs-actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 20px;
        }

        /* Individual SRS button */
        .srs-btn {
            flex-grow: 1;
            border: none;
            padding: 12px 15px;
            font-size: 0.9em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .srs-btn:hover { transform: translateY(-2px); }

        /* SRS button specific colors */
        #srs-again-btn { background-color: #c0392b; color: white; }
        #srs-hard-btn { background-color: #e67e22; color: white; }
        #srs-good-btn { background-color: #2980b9; color: white; }
        #srs-easy-btn { background-color: #27ae60; color: white; }

        /* Speak button */
        #speak-btn {
            background-color: transparent;
            border: 2px solid #7f8c8d;
            color: #7f8c8d;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
        }
        #speak-btn:hover { background-color: #7f8c8d; color: #34495e; }
        
        /* Stats and Data Management Area */
        .top-bar {
            position: absolute;
            top: 15px;
            right: 20px;
            left: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stats-container { font-size: 0.9em; color: #bdc3c7; }
        .data-management { display: flex; gap: 10px; }
        
        /* Custom Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; transition: opacity 0.3s; }
        .modal-content { background-color: #34495e; padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transform: scale(0.95); transition: transform 0.3s; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-content p { font-size: 1.1em; margin-top: 0; margin-bottom: 20px; }
        .modal-buttons { display: flex; gap: 15px; justify-content: center; }
        #modal-confirm-btn { background-color: #c0392b; color: white; }

        /* Toast Notification Styles */
        .toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1001;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: bottom 0.5s ease-in-out;
        }
        .toast.show { bottom: 40px; }
        .toast.error { background-color: #c0392b; }
    </style>
</head>
<body>
    <div class="quiz-container">
        <!-- Top bar for stats and data management -->
        <div class="top-bar">
            <div id="stats" class="stats-container">YÃ¼kleniyor...</div>
            <div class="data-management">
                <button id="save-btn" class="srs-btn" style="background-color: #16a085;">Ä°lerlemeyi Ä°ndir</button>
                <label for="load-input" class="srs-btn" style="background-color: #3498db; cursor: pointer;">Ä°lerleme YÃ¼kle</label>
                <input type="file" id="load-input" accept=".json" style="display: none;">
                <button id="reset-btn" class="srs-btn" style="background-color: #e74c3c;">SÄ±fÄ±rla</button>
            </div>
        </div>

        <!-- Question Area -->
        <div id="question-area">
            <div class="question-header">
                <p id="sentence" class="sentence"></p>
                <button id="speak-btn" title="Telaffuzu Dinle">ðŸ”Š</button>
            </div>
            <p id="prompt" class="prompt"></p>
            <div id="options" class="options-grid"></div>
        </div>

        <!-- Action Buttons -->
        <div id="srs-controls" class="srs-actions" style="display: none;">
            <button id="srs-again-btn" class="srs-btn">Tekrar (10d)</button>
            <button id="srs-hard-btn" class="srs-btn">Zor</button>
            <button id="srs-good-btn" class="srs-btn">Ä°yi</button>
            <button id="srs-easy-btn" class="srs-btn">Kolay</button>
        </div>
        <div class="srs-actions">
             <button id="next-question-btn" class="srs-btn" style="display: none; background-color: #3498db; width: 100%;">Sonraki Soru â†’</button>
        </div>
    </div>

    <!-- Custom Modal for confirmations -->
    <div id="custom-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p id="modal-text"></p>
            <div class="modal-buttons">
                <button id="modal-confirm-btn" class="srs-btn"></button>
                <button id="modal-cancel-btn" class="srs-btn" style="background-color: #7f8c8d;">Ä°ptal</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification for feedback -->
    <div id="toast-notification" class="toast"></div>

    <script>
        // DOM Element References
        const sentenceEl = document.getElementById('sentence');
        const promptEl = document.getElementById('prompt');
        const optionsEl = document.getElementById('options');
        const srsControlsEl = document.getElementById('srs-controls');
        const statsEl = document.getElementById('stats');
        const speakBtn = document.getElementById('speak-btn');
        const resetBtn = document.getElementById('reset-btn');
        const saveBtn = document.getElementById('save-btn');
        const loadInput = document.getElementById('load-input');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        
        // SRS Buttons
        const srsAgainBtn = document.getElementById('srs-again-btn');
        const srsHardBtn = document.getElementById('srs-hard-btn');
        const srsGoodBtn = document.getElementById('srs-good-btn');
        const srsEasyBtn = document.getElementById('srs-easy-btn');

        // Modal and Toast Elements
        const customModal = document.getElementById('custom-modal');
        const modalText = document.getElementById('modal-text');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const toast = document.getElementById('toast-notification');
        let toastTimeout;

        // Application State
        let allQuestions = [];
        let dueQuestionsPool = [];
        let totalDueToday = 0;
        let currentQuestion = null;
        
        // SRS Intervals (in days)
        const srsIntervals = {
            hard: [1, 2, 4, 8, 15, 30, 60],
            good: [1, 3, 7, 15, 30, 60, 120],
            easy: [4, 10, 30, 90, 180, 360]
        };

        // --- Core Functions ---

        async function startQuiz() {
            try {
                const response = await fetch('soru_bankasi.json');
                if (!response.ok) throw new Error('Soru bankasÄ± yÃ¼klenemedi.');
                const data = await response.json();
                allQuestions = data.flatMap(word => word.questions.map(q => ({...q, word: word.word, meaning: word.meaning})));
                
                prepareDueQuestions();
                displayQuestion();
                updateStats();
            } catch (error) {
                console.error("BaÅŸlatma hatasÄ±:", error);
                promptEl.textContent = 'Sorular yÃ¼klenirken bir hata oluÅŸtu. LÃ¼tfen sayfayÄ± yenileyin.';
            }
        }

        function prepareDueQuestions() {
            const states = JSON.parse(localStorage.getItem('questionStates')) || {};
            const today = new Date().toISOString().split('T')[0];
            
            const dueQuestions = allQuestions.filter(q => {
                const state = states[q.questionId];
                return !state || !state.dueDate || state.dueDate <= today;
            });
            
            dueQuestionsPool = dueQuestions.sort(() => Math.random() - 0.5);
            totalDueToday = dueQuestionsPool.length;
        }

        function displayQuestion() {
            nextQuestionBtn.style.display = 'none'; // Hide next button on new question

            if (dueQuestionsPool.length === 0) {
                promptEl.textContent = "BugÃ¼nlÃ¼k tÃ¼m sorularÄ± tamamladÄ±nÄ±z! Harika iÅŸ Ã§Ä±kardÄ±nÄ±z. YarÄ±n tekrar gelin.";
                sentenceEl.textContent = "ï¿½";
                optionsEl.innerHTML = '';
                srsControlsEl.style.display = 'none';
                updateStats();
                return;
            }

            currentQuestion = dueQuestionsPool[0];
            srsControlsEl.style.display = 'none';
            optionsEl.style.display = 'grid';

            const sentenceText = currentQuestion.sentence.replace('[__WORD__]', `<strong>${currentQuestion.word}</strong>`);
            sentenceEl.innerHTML = sentenceText || `Kelime: <strong>${currentQuestion.word}</strong>`;
            promptEl.textContent = currentQuestion.prompt;
            
            optionsEl.innerHTML = '';
            for (const [key, value] of Object.entries(currentQuestion.options)) {
                const button = document.createElement('button');
                button.classList.add('option-btn');
                button.dataset.key = key;
                button.textContent = `${key.toUpperCase()}. ${value}`;
                button.onclick = () => checkAnswer(key);
                optionsEl.appendChild(button);
            }
            updateStats();
        }

        function checkAnswer(selectedKey) {
            const isCorrect = selectedKey === currentQuestion.correctAnswer;
            
            Array.from(optionsEl.children).forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.key === currentQuestion.correctAnswer) {
                    btn.style.backgroundColor = '#2ecc71'; // Correct answer
                } else if (btn.dataset.key === selectedKey) {
                    btn.style.backgroundColor = '#e74c3c'; // Incorrect answer
                }
            });

            optionsEl.style.display = 'none';

            if (isCorrect) {
                srsControlsEl.style.display = 'flex';
                updateDailyStats();
            } else {
                const failedQuestion = dueQuestionsPool.shift();
                dueQuestionsPool.push(failedQuestion);
                nextQuestionBtn.style.display = 'block';
            }
        }
        
        function updateQuestionState(rating) {
            const states = JSON.parse(localStorage.getItem('questionStates')) || {};
            const questionId = currentQuestion.questionId;
            const currentState = states[questionId] || { level: 0, rating: 'new' };
            
            const nextDueDate = new Date();
            nextDueDate.setHours(5, 0, 0, 0); // Set due time to 5 AM

            if (rating === 'again') {
                currentState.level = 0;
                nextDueDate.setMinutes(nextDueDate.getMinutes() + 10);
            } else {
                const intervals = srsIntervals[rating];
                let level = currentState.level || 0;
                if (rating === 'hard' && level > 0) level--;
                if (rating === 'good') level++;
                if (rating === 'easy') level += 2;
                
                currentState.level = Math.min(level, intervals.length - 1);
                const intervalDays = intervals[currentState.level];
                nextDueDate.setDate(nextDueDate.getDate() + intervalDays);
            }
           
            currentState.dueDate = nextDueDate.toISOString().split('T')[0];
            currentState.rating = rating;
            states[questionId] = currentState;
            localStorage.setItem('questionStates', JSON.stringify(states));
            
            dueQuestionsPool.shift();
            displayQuestion();
        }

        // --- Utility and UI Functions ---

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const stats = JSON.parse(localStorage.getItem('dailyStats')) || {};
            const dailyCount = stats[today] || 0;
            statsEl.textContent = `BugÃ¼n: ${dueQuestionsPool.length}/${totalDueToday} | Ã–ÄŸrenilen: ${dailyCount}`;
        }

        function updateDailyStats() {
            const today = new Date().toISOString().split('T')[0];
            const stats = JSON.parse(localStorage.getItem('dailyStats')) || {};
            stats[today] = (stats[today] || 0) + 1;
            localStorage.setItem('dailyStats', JSON.stringify(stats));
            updateStats();
        }

        function resetProgress() {
            showModal(
                "TÃ¼m Ã¶ÄŸrenme ilerlemeniz ve istatistikleriniz silinecek. Bu iÅŸlem geri alÄ±namaz. Emin misiniz?",
                "Evet, Hepsini Sil",
                () => {
                    localStorage.removeItem('questionStates');
                    localStorage.removeItem('dailyStats');
                    showToast("Ä°lerleme sÄ±fÄ±rlandÄ±. Sayfa yeniden baÅŸlatÄ±lÄ±yor.");
                    setTimeout(() => location.reload(), 1500);
                }
            );
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.cancel(); // Cancel any previous speech
                window.speechSynthesis.speak(utterance);
            } else {
                showToast('TarayÄ±cÄ±nÄ±z seslendirmeyi desteklemiyor.', true);
            }
        }

        function showModal(text, confirmText, onConfirm) {
            modalText.textContent = text;
            modalConfirmBtn.textContent = confirmText;
            customModal.style.display = 'flex';
            
            setTimeout(() => customModal.classList.add('show'), 10);

            const newConfirmBtn = modalConfirmBtn.cloneNode(true);
            modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, modalConfirmBtn);
            
            newConfirmBtn.onclick = () => {
                onConfirm();
                customModal.classList.remove('show');
                setTimeout(() => customModal.style.display = 'none', 300);
            };

            modalCancelBtn.onclick = () => {
                customModal.classList.remove('show');
                setTimeout(() => customModal.style.display = 'none', 300);
            };
        }
        
        function showToast(message, isError = false) {
            clearTimeout(toastTimeout);
            toast.textContent = message;
            toast.className = 'toast';
            if (isError) {
                toast.classList.add('error');
            }
            toast.classList.add('show');
            
            toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // --- Data Management Event Listeners ---

        saveBtn.addEventListener('click', () => {
            const questionStates = localStorage.getItem('questionStates');
            const dailyStats = localStorage.getItem('dailyStats');

            if (!questionStates) {
                showToast('Kaydedilecek bir ilerleme bulunamadÄ±.', true);
                return;
            }

            const progressData = {
                questionStates: JSON.parse(questionStates),
                dailyStats: JSON.parse(dailyStats || '{}')
            };

            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.download = 'WEng_ilerleme.json';
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showToast('Ä°lerleme dosyasÄ± indirildi!');
        });

        loadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const progressData = JSON.parse(e.target.result);
                    if (progressData.questionStates) {
                        localStorage.setItem('questionStates', JSON.stringify(progressData.questionStates));
                    }
                    if (progressData.dailyStats) {
                        localStorage.setItem('dailyStats', JSON.stringify(progressData.dailyStats));
                    }
                    showToast('Ä°lerleme baÅŸarÄ±yla yÃ¼klendi! Sayfa yeniden baÅŸlatÄ±lÄ±yor.');
                    setTimeout(() => location.reload(), 1500);
                } catch (error) {
                    showToast('GeÃ§ersiz dosya formatÄ± veya dosya bozuk.', true);
                    console.error("Dosya yÃ¼kleme hatasÄ±:", error);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        });
        
        // --- Initial Event Listeners ---
        
        speakBtn.addEventListener('click', () => {
            if (currentQuestion) {
                speakWord(currentQuestion.word);
            }
        });

        nextQuestionBtn.addEventListener('click', displayQuestion);
        resetBtn.addEventListener('click', resetProgress);
        srsAgainBtn.addEventListener('click', () => updateQuestionState('again'));
        srsHardBtn.addEventListener('click', () => updateQuestionState('hard'));
        srsGoodBtn.addEventListener('click', () => updateQuestionState('good'));
        srsEasyBtn.addEventListener('click', () => updateQuestionState('easy'));
        
        // Start the application
        startQuiz();
    </script>
</body>
</html>
ï¿½